<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Manager</title>
    <!-- Add React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@react-spring/web@9.5.5/dist/web.umd.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --primary-color: #fffbeb;
            --accent-color: #fef3c7;
            --text-color: #1f2937;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--primary-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--text-color);
            font-size: 2.5rem;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .card-preview {
            background-color: white;
            border-radius: 50%;
            height: 200px;
            width: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), 
                        box-shadow 0.5s ease, 
                        background-position 10s linear infinite;
            box-shadow: 0 4px 6px var(--shadow-color);
            overflow: hidden;
            position: relative;
            margin: 0 auto;
            background-size: 200% 200%;
            animation: cardPulse 8s infinite alternate ease-in-out;
        }

        .card-preview:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px var(--shadow-color);
        }

        .card-preview h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            text-align: center;
            padding: 0 1rem;
        }

        .card-preview p {
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .add-btn-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            animation: fadeIn 1s 0.5s forwards;
        }

        .add-card-btn {
            background-color: white;
            color: var(--text-color);
            border: none;
            border-radius: 50px;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            box-shadow: 0 4px 6px var(--shadow-color);
            display: flex;
            align-items: center;
            gap: 10px;
            overflow: hidden;
            position: relative;
        }

        .add-card-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px var(--shadow-color);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal h2 {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-secondary {
            background-color: #e5e7eb;
            color: var(--text-color);
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--text-color);
        }

        .btn:hover {
            opacity: 0.9;
        }

        .card-details {
            background-color: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 25px var(--shadow-color);
            animation: fadeIn 0.5s ease;
        }

        .card-details h2 {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .card-info {
            margin-bottom: 1.5rem;
        }

        .card-info p {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .card-info p span:first-child {
            font-weight: 500;
        }

        .delete-btn {
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1rem;
        }

        .delete-btn:hover {
            background-color: #fecaca;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-color);
            padding: 0.5rem;
        }

        .hidden {
            display: none;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 0;
            color: #6b7280;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 1rem;
            color: #d1d5db;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .card-type-badge {
            display: none; /* Hide the badge */
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes cardPulse {
            0% {
                background-position: 0% 0%;
            }
            100% {
                background-position: 100% 100%;
            }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #d1fae5;
            color: #065f46;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 2000;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .error-notification {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .card-logo {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #6b7280;
        }

        /* Card color schemes */
        .card-visa {
            background: linear-gradient(135deg, #1c2e94, #3a4ebd);
            color: white;
        }

        .card-mastercard {
            background: linear-gradient(135deg, #ff8a00, #ffbd45);
            color: white;
        }

        .card-amex {
            background: linear-gradient(135deg, #0071ce, #3d9bff);
            color: white;
        }

        .card-discover {
            background: linear-gradient(135deg, #ff6d00, #ffad75);
            color: white;
        }

        .card-generic {
            background: linear-gradient(135deg, #fef3c7, #fffbeb);
            color: var(--text-color);
        }

        .card-icon-container {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        /* Auth Form Styles */
        .auth-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 2rem;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
            animation: fadeIn 0.5s ease;
        }

        .auth-container h2 {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: 500;
        }

        .auth-tab.active {
            border-bottom: 2px solid var(--accent-color);
            color: var(--accent-color);
        }

        .auth-form {
            margin-bottom: 1rem;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .auth-switch a {
            color: var(--accent-color);
            text-decoration: none;
            cursor: pointer;
        }

        .user-menu {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 2rem;
            align-items: center;
            gap: 1rem;
            animation: fadeIn 0.5s ease;
        }

        .user-email {
            font-weight: 500;
        }

        .logout-btn {
            background-color: #e5e7eb;
            color: var(--text-color);
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background-color: #d1d5db;
        }

        /* Loading spinner */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-btn {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .loading-btn .loader {
            display: inline-block;
        }
        
        .btn .loader {
            display: none;
        }

        /* Styles for SplitText */
        .split-text {
            display: inline-block;
        }

        /* Styles for ShinyText */
        .shiny-text {
            display: inline-block;
            background: linear-gradient(
                120deg,
                rgba(255, 255, 255, 0) 40%,
                rgba(255, 255, 255, 0.8) 50%,
                rgba(255, 255, 255, 0) 60%
            );
            background-size: 200% 100%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 5s linear infinite;
        }

        @keyframes shine {
            0% {
                background-position: 100% 0;
            }
            100% {
                background-position: -100% 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="app-title">Card Manager</h1>

        <!-- Authentication View -->
        <div id="auth-view">
            <div class="auth-container">
                <h2>Welcome to Card Manager</h2>
                <div class="auth-tabs">
                    <div id="login-tab" class="auth-tab active">Login</div>
                    <div id="signup-tab" class="auth-tab">Sign Up</div>
                </div>
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" placeholder="Your username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <span class="loader"></span>
                        Login
                    </button>
                </form>
                <form id="signup-form" class="auth-form hidden">
                    <div class="form-group">
                        <label for="signup-username">Username</label>
                        <input type="text" id="signup-username" placeholder="Choose a username" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" placeholder="Your password (min 6 characters)" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm-password">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" placeholder="Confirm your password" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <span class="loader"></span>
                        Sign Up
                    </button>
                </form>
            </div>
        </div>

        <!-- Main App View -->
        <div id="app-view" class="hidden">
            <!-- User Menu -->
            <div class="user-menu">
                <span class="user-email" id="user-email">username</span>
                <button id="logout-btn" class="logout-btn">Logout</button>
            </div>

            <!-- Home view with list of cards -->
            <div id="home-view">
                <div id="cards-container" class="cards-container">
                    <!-- Cards will be added here dynamically -->
                </div>

                <div class="add-btn-container">
                    <button id="add-card-btn" class="add-card-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        <span id="add-btn-text">Add Card</span>
                    </button>
                </div>
            </div>

            <!-- Card details view -->
            <div id="card-details-view" class="hidden">
                <button id="back-btn" class="back-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Back to Cards
                </button>

                <div class="card-details">
                    <h2 id="card-detail-nickname">Card Nickname</h2>
                    <div class="card-info">
                        <p>
                            <span>Card Number:</span>
                            <span id="card-detail-number">1234 1234 1234 1234</span>
                        </p>
                        <p>
                            <span>Expiration Date:</span>
                            <span id="card-detail-expiry">MM/YY</span>
                        </p>
                        <p>
                            <span>3 Numbers On Da Back:</span>
                            <span id="card-detail-three">123</span>
                        </p>
                        <p>
                            <span>Card Type:</span>
                            <span id="card-detail-type">Visa</span>
                        </p>
                    </div>

                    <button id="delete-card-btn" class="delete-btn">Delete Card</button>
                </div>
            </div>

            <!-- Add card modal -->
            <div id="add-card-modal" class="modal">
                <div class="modal-content">
                    <h2>Add New Card</h2>
                    <form id="add-card-form">
                        <div class="form-group">
                            <label for="card-nickname">Card Nickname</label>
                            <input type="text" id="card-nickname" placeholder="E.g., Work Visa" required>
                        </div>
                        <div class="form-group">
                            <label for="card-number">Card Number</label>
                            <input type="text" id="card-number" placeholder="1234 5678 9012 3456" maxlength="19" required>
                        </div>
                        <div class="form-group">
                            <label for="card-expiry">Expiration Date</label>
                            <input type="text" id="card-expiry" placeholder="MM/YY" maxlength="5" required>
                        </div>
                        <div class="form-group">
                            <label for="card-cvv">3 Numbers On Da Back</label>
                            <input type="text" id="card-cvv" placeholder="123" required>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="cancel-add-card" class="btn btn-secondary">Cancel</button>
                            <button type="submit" class="btn btn-primary">
                                <span class="loader"></span>
                                Save Card
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="notification">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span id="notification-message">Card added successfully!</span>
        </div>
    </div>

    <!-- Import Firebase -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, getDoc, deleteDoc, query, where } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js';

        // Your web app's Firebase configuration
        // These are your actual Firebase configuration details from your project
        const firebaseConfig = {
            apiKey: "AIzaSyBB1pzTv6APvqwrR_RCtlr6yNdIbvnZSXA",
            authDomain: "card-manager-a0fae.firebaseapp.com",
            projectId: "card-manager-a0fae",
            storageBucket: "card-manager-a0fae.appspot.com",
            messagingSenderId: "54289334274",
            appId: "1:54289334274:web:fe4bf1e251fcf85891271b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // The domain to append to usernames to create email format
        const DOMAIN = "cardmanager.com";

        // Function to convert username to email format
        function usernameToEmail(username) {
            return `${username}@${DOMAIN}`;
        }

        // Function to extract username from email 
        function emailToUsername(email) {
            return email.split('@')[0];
        }

        // DOM Elements
        const authView = document.getElementById('auth-view');
        const appView = document.getElementById('app-view');
        const homeView = document.getElementById('home-view');
        const cardDetailsView = document.getElementById('card-details-view');
        const cardsContainer = document.getElementById('cards-container');
        const addCardBtn = document.getElementById('add-card-btn');
        const addCardModal = document.getElementById('add-card-modal');
        const addCardForm = document.getElementById('add-card-form');
        const cancelAddCardBtn = document.getElementById('cancel-add-card');
        const backBtn = document.getElementById('back-btn');
        const deleteCardBtn = document.getElementById('delete-card-btn');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        
        // Auth Elements
        const loginTab = document.getElementById('login-tab');
        const signupTab = document.getElementById('signup-tab');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const userEmailDisplay = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');
        
        // Card detail elements
        const cardDetailNickname = document.getElementById('card-detail-nickname');
        const cardDetailNumber = document.getElementById('card-detail-number');
        const cardDetailExpiry = document.getElementById('card-detail-expiry');
        const cardDetailHolder = document.getElementById('card-detail-three');
        const cardDetailType = document.getElementById('card-detail-type');
        
        // Form inputs
        const cardNicknameInput = document.getElementById('card-nickname');
        const cardNumberInput = document.getElementById('card-number');
        const cardExpiryInput = document.getElementById('card-expiry');
        const cardHolderInput = document.getElementById('card-cvv');
        
        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in
                authView.classList.add('hidden');
                appView.classList.remove('hidden');
                // Display username instead of email
                userEmailDisplay.textContent = emailToUsername(user.email);
                loadCards();
            } else {
                // User is signed out
                appView.classList.add('hidden');
                authView.classList.remove('hidden');
                // Clear forms
                loginForm.reset();
                signupForm.reset();
            }
        });
        
        // Auth event listeners
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            signupTab.classList.remove('active');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        });
        
        signupTab.addEventListener('click', () => {
            signupTab.classList.add('active');
            loginTab.classList.remove('active');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });
        
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const submitBtn = loginForm.querySelector('button[type="submit"]');
            
            // Convert username to email format for Firebase
            const email = usernameToEmail(username);
            
            try {
                submitBtn.classList.add('loading-btn');
                await signInWithEmailAndPassword(auth, email, password);
                // Successful login handled by onAuthStateChanged
            } catch (error) {
                showNotification(`Login failed: ${error.message}`, true);
            } finally {
                submitBtn.classList.remove('loading-btn');
            }
        });
        
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('signup-username').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            const submitBtn = signupForm.querySelector('button[type="submit"]');
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', true);
                return;
            }
            
            // Convert username to email format for Firebase
            const email = usernameToEmail(username);
            
            try {
                submitBtn.classList.add('loading-btn');
                await createUserWithEmailAndPassword(auth, email, password);
                // Successful signup handled by onAuthStateChanged
            } catch (error) {
                showNotification(`Signup failed: ${error.message}`, true);
            } finally {
                submitBtn.classList.remove('loading-btn');
            }
        });
        
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                // Successful logout handled by onAuthStateChanged
            } catch (error) {
                showNotification(`Logout failed: ${error.message}`, true);
            }
        });
        
        // App initialization
        function init() {
            // Event listeners
            addCardBtn.addEventListener('click', openAddCardModal);
            cancelAddCardBtn.addEventListener('click', closeAddCardModal);
            addCardForm.addEventListener('submit', handleAddCard);
            backBtn.addEventListener('click', showHomeView);
            deleteCardBtn.addEventListener('click', handleDeleteCard);
            
            // Format card number input with spaces
            cardNumberInput.addEventListener('input', formatCardNumber);
            
            // Format expiry date input with slash
            cardExpiryInput.addEventListener('input', formatExpiryDate);
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === addCardModal) {
                    closeAddCardModal();
                }
            });
        }
        
        // Initialize the app
        init();
        
        // Load cards for current user from Firestore
        async function loadCards() {
            const user = auth.currentUser;
            if (!user) return;
            
            try {
                const q = query(collection(db, "cards"), where("userId", "==", user.uid));
                const querySnapshot = await getDocs(q);
                
                // Clear existing cards
                cardsContainer.innerHTML = '';
                
                // Check if there are no cards
                if (querySnapshot.empty) {
                    renderEmptyState();
                    return;
                }
                
                // Create card previews
                let delay = 0;
                querySnapshot.forEach((doc) => {
                    const card = doc.data();
                    const cardElement = createCardPreview(doc.id, card);
                    cardElement.style.animationDelay = `${delay}s`;
                    cardsContainer.appendChild(cardElement);
                    delay += 0.1;
                });
            } catch (error) {
                showNotification(`Error loading cards: ${error.message}`, true);
            }
        }
        
        function renderEmptyState() {
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                </svg>
                <h3>No Cards Yet</h3>
                <p>Add your first card to get started</p>
            `;
            cardsContainer.appendChild(emptyState);
        }
        
        function createCardPreview(cardId, card) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card-preview fade-in';
            cardElement.dataset.cardId = cardId;
            
            // Get card type and set appropriate class
            const cardType = detectCardType(card.number);
            const cardClass = getCardClass(cardType);
            cardElement.classList.add(cardClass);
            
            // Card icon
            const cardIcon = getCardIcon(cardType);
            
            // Display full card number - no masking
            cardElement.innerHTML = `
                <div class="card-type-badge">${cardType}</div>
                <div class="card-icon-container">
                    ${cardIcon}
                </div>
                <h3>${card.nickname}</h3>
                <p>${formatCardNumber(card.number)}</p>
            `;
            
            cardElement.addEventListener('click', () => {
                showCardDetails(cardId);
            });
            
            return cardElement;
        }
        
        function openAddCardModal() {
            addCardModal.classList.add('active');
            cardNicknameInput.focus();
        }
        
        function closeAddCardModal() {
            addCardModal.classList.remove('active');
            addCardForm.reset();
        }
        
        async function handleAddCard(e) {
            e.preventDefault();
            
            const user = auth.currentUser;
            if (!user) return;
            
            const submitBtn = addCardForm.querySelector('button[type="submit"]');
            submitBtn.classList.add('loading-btn');
            
            const newCard = {
                nickname: cardNicknameInput.value,
                number: cardNumberInput.value,
                expiry: cardExpiryInput.value,
                holder: cardHolderInput.value,
                userId: user.uid, // Important: associate card with user
                createdAt: new Date().toISOString()
            };
            
            try {
                // Add card to Firestore
                await addDoc(collection(db, "cards"), newCard);
                
                // Close modal
                closeAddCardModal();
                
                // Show notification
                showNotification('Card added successfully!');
                
                // Reload cards
                loadCards();
            } catch (error) {
                showNotification(`Error adding card: ${error.message}`, true);
            } finally {
                submitBtn.classList.remove('loading-btn');
            }
        }
        
        async function showCardDetails(cardId) {
            const user = auth.currentUser;
            if (!user) return;
            
            try {
                // Get card document from Firestore
                const cardDoc = await getDoc(doc(db, "cards", cardId));
                
                if (cardDoc.exists()) {
                    const card = cardDoc.data();
                    
                    // Verify card belongs to current user
                    if (card.userId !== user.uid) {
                        showNotification('You do not have permission to view this card', true);
                        return;
                    }
                    
                    // Populate card details - show full numbers without masking
                    cardDetailNickname.textContent = card.nickname;
                    cardDetailNumber.textContent = formatCardNumber(card.number);
                    cardDetailExpiry.textContent = card.expiry;
                    cardDetailHolder.textContent = card.holder;
                    cardDetailType.textContent = detectCardType(card.number);
                    
                    // Set delete button data
                    deleteCardBtn.dataset.cardId = cardId;
                    
                    // Show card details view
                    homeView.classList.add('hidden');
                    cardDetailsView.classList.remove('hidden');
                } else {
                    showNotification('Card not found', true);
                }
            } catch (error) {
                showNotification(`Error loading card details: ${error.message}`, true);
            }
        }
        
        function showHomeView() {
            cardDetailsView.classList.add('hidden');
            homeView.classList.remove('hidden');
        }
        
        async function handleDeleteCard() {
            const user = auth.currentUser;
            if (!user) return;
            
            const cardId = deleteCardBtn.dataset.cardId;
            if (!cardId) return;
            
            try {
                // Get card document to verify ownership
                const cardDoc = await getDoc(doc(db, "cards", cardId));
                
                if (cardDoc.exists()) {
                    const card = cardDoc.data();
                    
                    // Verify card belongs to current user
                    if (card.userId !== user.uid) {
                        showNotification('You do not have permission to delete this card', true);
                        return;
                    }
                    
                    // Delete card from Firestore
                    await deleteDoc(doc(db, "cards", cardId));
                    
                    // Show notification
                    showNotification('Card deleted successfully!');
                    
                    // Go back to home view
                    showHomeView();
                    
                    // Reload cards
                    loadCards();
                } else {
                    showNotification('Card not found', true);
                }
            } catch (error) {
                showNotification(`Error deleting card: ${error.message}`, true);
            }
        }
        
        function formatCardNumber(e) {
            let value;
            if (typeof e === 'string') {
                // When formatting an existing card number
                value = e.replace(/\s/g, '');
            } else {
                // When formatting input
                value = e.target.value.replace(/\D/g, '');
                e.target.value = formatCardNumber(value);
                return;
            }
            
            // Add spaces after every 4 digits
            let formattedValue = '';
            for (let i = 0; i < value.length; i++) {
                if (i > 0 && i % 4 === 0) {
                    formattedValue += ' ';
                }
                formattedValue += value[i];
            }
            
            return formattedValue;
        }
        
        function formatExpiryDate(e) {
            let value = e.target.value.replace(/\D/g, '');
            let formattedValue = '';
            
            if (value.length > 0) {
                formattedValue = value.substring(0, 2);
                if (value.length > 2) {
                    formattedValue += '/' + value.substring(2, 4);
                }
            }
            
            e.target.value = formattedValue;
        }
        
        function detectCardType(number) {
            const cleaned = number.replace(/\s/g, '');
            const firstDigit = cleaned.charAt(0);
            const firstTwoDigits = parseInt(cleaned.substring(0, 2));
            
            if (firstDigit === '4') {
                return 'Visa';
            } else if (firstTwoDigits >= 51 && firstTwoDigits <= 55) {
                return 'MasterCard';
            } else if (firstTwoDigits === 34 || firstTwoDigits === 37) {
                return 'AmEx';
            } else if (firstTwoDigits === 60) {
                return 'Discover';
            } else {
                return 'Card';
            }
        }
        
        function getCardClass(cardType) {
            switch(cardType) {
                case 'Visa':
                    return 'card-visa';
                case 'MasterCard':
                    return 'card-mastercard';
                case 'AmEx':
                    return 'card-amex';
                case 'Discover':
                    return 'card-discover';
                default:
                    return 'card-generic';
            }
        }
        
        function getCardIcon(cardType) {
            switch(cardType) {
                case 'Visa':
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" viewBox="0 0 24 24">
                        <path d="M23 5v14H1V5h22m0-2H1C0 3 0 4 0 4v16c0 0 0 1 1 1h22c1 0 1-1 1-1V4c0 0 0-1-1-1z"/>
                        <path d="M4 12h4v1H4z"/>
                    </svg>`;
                case 'MasterCard':
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" viewBox="0 0 24 24">
                        <path d="M23 5v14H1V5h22m0-2H1C0 3 0 4 0 4v16c0 0 0 1 1 1h22c1 0 1-1 1-1V4c0 0 0-1-1-1z"/>
                        <circle cx="8" cy="12" r="3"/>
                        <circle cx="16" cy="12" r="3"/>
                    </svg>`;
                case 'AmEx':
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" viewBox="0 0 24 24">
                        <path d="M23 5v14H1V5h22m0-2H1C0 3 0 4 0 4v16c0 0 0 1 1 1h22c1 0 1-1 1-1V4c0 0 0-1-1-1z"/>
                        <path d="M14 7v10h-4V7h4M4 7h4v2H4z"/>
                    </svg>`;
                case 'Discover':
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" viewBox="0 0 24 24">
                        <path d="M23 5v14H1V5h22m0-2H1C0 3 0 4 0 4v16c0 0 0 1 1 1h22c1 0 1-1 1-1V4c0 0 0-1-1-1z"/>
                        <circle cx="12" cy="12" r="5"/>
                    </svg>`;
                default:
                    return `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" viewBox="0 0 24 24">
                        <path d="M23 5v14H1V5h22m0-2H1C0 3 0 4 0 4v16c0 0 0 1 1 1h22c1 0 1-1 1-1V4c0 0 0-1-1-1z"/>
                        <path d="M4 9h16v2H4zm0 4h10v2H4z"/>
                    </svg>`;
            }
        }
        
        function showNotification(message, isError = false) {
            notificationMessage.textContent = message;
            
            if (isError) {
                notification.classList.add('error-notification');
            } else {
                notification.classList.remove('error-notification');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>

    <!-- React animations script for title and buttons -->
    <script type="text/babel">
        // SplitText Component
        const SplitText = ({ text, className = '' }) => {
            const { animated } = ReactSpringWeb;
            const [springs, api] = ReactSpringWeb.useSprings(
                text.length,
                i => ({
                    from: { opacity: 0, transform: 'translateY(20px)' },
                    to: { opacity: 1, transform: 'translateY(0px)' },
                    delay: i * 100,
                    config: { tension: 200, friction: 15 }
                })
            );

            return (
                <span className={`split-text ${className}`}>
                    {springs.map((props, i) => (
                        <animated.span key={i} style={props}>
                            {text[i] === ' ' ? '\u00A0' : text[i]}
                        </animated.span>
                    ))}
                </span>
            );
        };

        // ShinyText Component for buttons
        const ShinyText = ({ text }) => {
            return (
                <span className="shiny-text">{text}</span>
            );
        };

        // Apply SplitText to title
        ReactDOM.render(
            <SplitText text="Card Manager" />,
            document.getElementById('app-title')
        );

        // Apply ShinyText to the Add Card button text
        ReactDOM.render(
            <ShinyText text="Add Card" />,
            document.getElementById('add-btn-text')
        );
    </script>
</body>
</html>